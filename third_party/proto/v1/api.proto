syntax = "proto3";

// Package Motor is used for defining a Motor node and its properties.
package sonrhq.protocol.auth.v1;

import "core/identity/v1/did.proto";
import "google/api/annotations.proto";
import "protocol/vault/v1/models.proto";

// option go_package = "github.com/sonrhq/core/x/identity/types/auth/v1";

// ==================================================================
// REGISTRATION
// ==================================================================

// ChallengeRequest is the request to generate a challenge.
message ChallengeRequest {
  // Optional RP ID to use for the challenge.
  string rp_id = 1;

  // Username to use for the AlsoKnownAs field in the didDoc
  string username = 2;
}

// ChallengeResponse is the response to a Challenge request.
message ChallengeResponse {
  string session_id = 1;
  string creation_options = 2;
  string rp_name = 3;
  repeated string rp_origins = 4;
  string rp_icon = 5;
}

// RegisterRequest is the request to register a new user.
message RegisterRequest {
  string session_id = 1;
  string username = 2;
  string registration_response = 3;
}

// RegisterResponse is the response to a Register request.
message RegisterResponse {
  bool success = 1;
  string username = 2;
  core.identity.v1.DidDocument did_document = 3;
}

// ==================================================================
// AUTHENTICATION
// ==================================================================

// AuthorizeRequest is the request to generate a challenge.
message AssertRequest {
  // Optional RP ID to use for the challenge.
  string rp_id = 1;

  // Identifier can be address or username.
  string identifier = 2;
}

// AuthorizeResponse is the response to a Challenge request.
message AssertResponse {
  string session_id = 1;
  string request_options = 2;
  string rp_name = 3;
  repeated string rp_origins = 4;
  string rp_icon = 5;
}

// LoginRequest is the request to register a new user.
message LoginRequest {
  string session_id = 1;
  string identifier = 2;
  string assertion_response = 3;
}

// LoginResponse is the response to a Register request.
message LoginResponse {
  bool success = 1;
  string username = 2;
  core.identity.v1.DidDocument did_document = 3;
}

// ==================================================================
// GRPC/REST SERVICE
// ==================================================================

// Auth is the service used for managing a node's JWT Sessions.
service Auth {
  // Challenge generates a challenge for registration returns it.
  rpc Challenge(ChallengeRequest) returns (ChallengeResponse) {
    option (google.api.http).get = "/sonr/protocol/auth/challenge/{rp_id}/{username}";
  }

  // Register registers a new user.
  rpc Register(RegisterRequest) returns (RegisterResponse) {
    option (google.api.http).post = "/sonr/protocol/auth/register";
  }

  // Assertion return credential assertion options.
  rpc Assertion(AssertRequest) returns (AssertResponse) {
    option (google.api.http).get = "/sonr/protocol/auth/assertion/{rp_id}/{identifier}";
  }

  // Login logs in a user.
  rpc Login(LoginRequest) returns (LoginResponse) {
    option (google.api.http).post = "/sonr/protocol/auth/login";
  }
}
