version: "3"
dir: $HOME
env:
  ROOT: $HOME/.sonr
  GENESIS: $HOME/.sonr/config/genesis.json
# -----------------------------------------------------------------------------
# -- Project Config ------------------------------------------------------------
# -----------------------------------------------------------------------------
vars:
  OPERATOR: sonrhq
  MONIKER: florence
  CHAIN_ID: sonr-testnet-1
  KEYRING_BACKEND: test
  LOG_LEVEL: info
  KEYALGO: secp256k1

# ----------------------------------------------------------------------------
# -- Public Tasks ------------------------------------------------------------
# ----------------------------------------------------------------------------
tasks:
  init:
    desc: Generate the protobuf files
    cmds:
      - echo {{.MNEMONIC}} | sonrd keys add {{.OPERATOR}} --keyring-backend {{.KEYRING_BACKEND}} --algo {{.KEYALGO}} --recover
      - sonrd init {{.MONIKER}} --chain-id {{.CHAIN_ID}}
      - task: setup-config
    vars:
      MNEMONIC:
        sh: echo $(doppler secrets get SONRHQ_OPERATOR_MNEMONIC --plain)
        default: "decorate bright ozone fork gallery riot bus exhaust worth way bone indoor calm squirrel merry zero scheme cotton until shop any excess stage laundry"

  add-account:
    desc: Add an account to the keyring
    cmds:
      - sonrd add-genesis-account {{.OPERATOR}} 100000000000000000000000000usnr --keyring-backend {{.KEYRING_BACKEND}}
      - sonrd gentx {{.OPERATOR}} 1000000000000000000000usnr --keyring-backend {{.KEYRING_BACKEND}} --chain-id {{.CHAIN_ID}}

  collect-genesis:
    desc: Validate the genesis file
    cmds:
      - sonrd collect-gentxs
      - sonrd validate-genesis

  print-genesis:
    desc: Print the genesis file
    cmds:
      - cat {{.GENESIS}}
# ------------------------------------------------------------------------------
# -- Internal Tasks ------------------------------------------------------------
# ------------------------------------------------------------------------------
  setup-config:
    silent: true
    internal: true
    desc: Build the go binary
    cmds:
      - toml set $HOME/.sonr/config/config.toml rpc.laddr tcp://0.0.0.0:26657 > /tmp/config.toml && mv /tmp/config.toml $HOME/.sonr/config/config.toml
      - toml set $HOME/.sonr/config/app.toml grpc.address 0.0.0.0:9000 > /tmp/app.toml && mv /tmp/app.toml $HOME/.sonr/config/app.toml
      - toml set $HOME/.sonr/config/app.toml api.enable true > /tmp/app.toml && mv /tmp/app.toml $HOME/.sonr/config/app.toml
      - toml set $HOME/.sonr/config/app.toml api.swagger true > /tmp/app.toml && mv /tmp/app.toml $HOME/.sonr/config/app.toml
      - toml set $HOME/.sonr/config/app.toml api.address tcp://0.0.0.0:1317 > /tmp/app.toml && mv /tmp/app.toml $HOME/.sonr/config/app.toml
      - toml set $HOME/.sonr/config/app.toml minimum-gas-prices 0.0000snr > /tmp/app.toml && mv /tmp/app.toml $HOME/.sonr/config/app.toml
    requires:
      vars: [OS,ARCH]
